<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a1a">
    <meta name="description" content="BowMafia DAO - Join the exclusive community of Bow enthusiasts">
    <meta name="robots" content="index, follow">
    <title>BowMafia - BowDAO</title>
    
    <!-- DNS prefetch for external resources -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    
    <!-- Mobile optimization -->
    <meta name="theme-color" content="#b19cd9">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            overflow-x: hidden;
            background-color: #1a1a1a;
        }
        
        .fullscreen-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            object-fit: cover;
            z-index: -1;
            background-color: #1a1a1a;
        }

        /* Mobile-specific video styling */
        @media (max-width: 768px) {
            .fullscreen-video {
                width: 100vw;
                height: 100vh;
                object-fit: cover;
                background: #1a1a1a;
            }
        }
        
        .hero {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .video-fallback {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: -2;
        }
        
        .button-container {
            display: flex;
            gap: 2rem;
            z-index: 10;
            position: relative;
            top: 120px;
        }
        
        .left-button, .right-button {
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .left-button {
            background: rgba(177, 156, 217, 0.9);
            color: #fff;
        }
        
        .right-button {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        
        .left-button:hover, .right-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .hamburger-menu {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
        }
        
        .hamburger-btn {
            background: rgba(177, 156, 217, 0.9);
            border: none;
            padding: 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            gap: 3px;
            box-shadow: 0 4px 12px rgba(177, 156, 217, 0.2);
            transition: background 0.3s;
        }

        .hamburger-btn:hover {
            background: #b19cd9;
        }
        
        .hamburger-line {
            width: 25px;
            height: 3px;
            background: #333;
            transition: 0.3s;
        }
        
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            z-index: 999;
        }
        
        .menu-overlay.active {
            display: flex;
        }
        
        .menu-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            gap: 2rem;
        }
        
        .menu-item {
            display: inline-block;
            background: rgba(177, 156, 217, 0.9);
            color: #fff;
            text-decoration: none;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            padding: 0.8rem 2rem;
            margin: 0.3rem 0;
            cursor: pointer;
            letter-spacing: 1px;
            text-transform: uppercase;
            box-shadow: 0 2px 8px rgba(177, 156, 217, 0.15);
            transition: background 0.3s, color 0.3s, box-shadow 0.3s;
        }
        
        .menu-item:hover {
            background: #9b7bc7;
            color: #fff;
            box-shadow: 0 4px 16px rgba(177, 156, 217, 0.25);
        }
        
        .about-section {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1000;
            background: rgba(34, 34, 34, 0.95);
            color: white;
            overflow-y: auto;
        }
        
        .about-content {
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
            text-align: center;
        }
        
        .about-content h1 {
            font-size: 2.8rem;
            margin-bottom: 1.2rem;
            letter-spacing: 1px;
        }
        
        .about-content div {
            max-width: 700px;
            width: 90vw;
            padding: 2rem;
            line-height: 1.6;
        }
        
        .about-content p {
            margin-bottom: 1rem;
        }
        
        .about-content h3 {
            margin-top: 2rem;
            font-size: 1.3rem;
            margin-bottom: 1rem;
        }
        
        #about-close {
            margin-top: 2.5rem;
            padding: 0.7em 2em;
            font-size: 1.2em;
            background: #fff;
            color: #222;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        #about-close:hover {
            background: #f0f0f0;
        }
        
        .footer {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
            z-index: 10;
            font-size: 0.9rem;
        }
        
        .footer a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
        }
        
        .footer a:hover {
            color: white;
        }
        
        .loading-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.2rem;
            z-index: 5;
            display: none;
        }
        
        /* Mobile video play overlay */
        .video-play-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(34, 34, 34, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            flex-direction: column;
        }
        
        .video-play-btn {
            padding: 1.5rem 3rem;
            font-size: 1.4rem;
            border-radius: 12px;
            background: #b19cd9;
            color: #fff;
            border: none;
            font-weight: bold;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .video-play-btn:hover {
            background: #9b7bc7;
            transform: translateY(-2px);
        }
        
        .video-play-instruction {
            margin-bottom: 2rem;
            color: white;
            font-size: 1.1rem;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .button-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            .left-button, .right-button {
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
            }
            
            .about-content h1 {
                font-size: 2rem;
            }
            
            .about-content div {
                padding: 1rem;
            }
            
            .video-play-btn {
                padding: 1.2rem 2.5rem;
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Video fallback background -->
    <div class="video-fallback"></div>
    
        <!-- Mobile video play overlay -->
    <div class="video-play-overlay" id="video-play-overlay">
        <div class="video-play-instruction">Tap to start background video</div>
        <button class="video-play-btn" id="video-play-btn">Play Video</button>
    </div>
    
    <!-- Mobile video play overlay -->
    <div class="video-play-overlay" id="video-play-overlay">
        <div class="video-play-instruction">Tap to start background video</div>
        <button class="video-play-btn" id="video-play-btn">Play Video</button>
    </div>
    
    <!-- Hamburger Menu -->
    <div class="hamburger-menu">
        <button class="hamburger-btn" id="hamburger-btn">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>
        <nav class="menu-overlay" id="menu-overlay">
            <div class="menu-content">
                <a href="assets.html" class="menu-item">ASSETS</a>
                <a href="popouts.html" class="menu-item">BOW X BOB</a>
                <a href="#about" class="menu-item" id="about-link">ABOUT US</a>
            </div>
        </nav>
    </div>

    <main>
        <section id="home" class="hero">
            <!-- Main background video -->
            <video 
                class="fullscreen-video" 
                id="main-video" 
                muted 
                loop 
                playsinline 
                webkit-playsinline
                preload="metadata"
                data-desktop-src="assets/videos/bowmafiadao.mp4"
                data-mobile-src="assets/videos/bowmafiadaomobile.mp4"
                data-mobile-webm-src="assets/videos/bowmafiadaomobile.webm">
                <source id="main-video-source-webm" src="" type="video/webm">
                <source id="main-video-source-mp4" src="assets/videos/bowmafiadao.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            
            <div class="button-container">
                <button class="left-button" onclick="window.location.href='dao.html'">Join the DAO</button>
                <button class="right-button" onclick="window.location.href='shop.html'">Silk & Bows</button>
            </div>
        </section>
        
        <!-- About Us Section -->
        <section id="about" class="about-section">
            <video class="fullscreen-video" id="about-video" muted loop playsinline preload="none">
                <source src="assets/videos/bowmafiadao.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <div class="about-content">
                <h1>About Us</h1>
                <div>
                    <p>Welcome to the Bow Mafia, home of the Bow DAO — a decentralized community built around passion, purpose, and the power of the Doginal Dogs.</p>
                    <p>We're not just another DAO. We're a movement focused on elevating one of the most iconic traits in the Doginals universe: the Bow Dog. These rare and expressive collectibles are at the heart of our mission — and we're here to raise their floor, build meaningful utility, and unlock real value for holders and contributors alike.</p>
                    <p>But you don't need to own a Bow Dog to be part of the family. The Bow Mafia is open to anyone who wants to support the Doginal ecosystem, contribute ideas, and help build something bigger than themselves. Whether you're an artist, developer, collector, or simply a DOGE enthusiast — there's a place for you here.</p>
                    <h3>Powered by Community</h3>
                    <p>Bow DAO is 100% community-led. That means decisions are made by the members — not a centralized team. Got an idea? Share it. Want to launch a new project? Pitch it. Proposals are discussed openly in our DAO channels, and votes happen transparently. While Bow Dog holders may hold more sway in future decisions, every voice matters.</p>
                </div>
                <button id="about-close">Close</button>
            </div>
        </section>
    </main>
    
    <!-- Footer -->
    <footer class="footer" id="main-footer">
        BowMafiaDAO © 2025 | <a href="#terms">Terms & Conditions</a>
    </footer>

    <script>
        // Enhanced mobile detection
        function isMobileDevice() {
            const userAgent = navigator.userAgent.toLowerCase();
            const mobileKeywords = ['android', 'webos', 'iphone', 'ipad', 'ipod', 'blackberry', 'windows phone', 'mobile'];
            const isMobileUA = mobileKeywords.some(keyword => userAgent.includes(keyword));
            const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            const isSmallScreen = window.innerWidth <= 768 || window.innerHeight <= 768;
            
            console.log('Mobile detection:', { isMobileUA, isTouchDevice, isSmallScreen });
            return isMobileUA || (isTouchDevice && isSmallScreen);
        }

        // iOS specific detection
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent);
        }

        // Android specific detection
        function isAndroid() {
            return /Android/.test(navigator.userAgent);
        }

        // Get DOM elements
        const mainVideo = document.getElementById('main-video');
        const mainVideoSourceWebm = document.getElementById('main-video-source-webm');
        const mainVideoSourceMp4 = document.getElementById('main-video-source-mp4');
        const aboutVideo = document.getElementById('about-video');
        const loadingMessage = document.getElementById('loading-message');
        const videoPlayOverlay = document.getElementById('video-play-overlay');
        const videoPlayBtn = document.getElementById('video-play-btn');

        let videoInitialized = false;
        let isVideoPlaying = false;
        let currentVideoAttempt = 0; // Track which video format we're trying

        // Check if browser supports WebM
        function supportsWebM() {
            const video = document.createElement('video');
            return video.canPlayType('video/webm') !== '';
        }

        // Check if video file exists
        async function checkVideoExists(url) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                return response.ok;
            } catch (error) {
                console.log('Video check failed for:', url, error);
                return false;
            }
        }

        // Set video sources with fallback logic
        async function setVideoSources(isMobile) {
            console.log('Setting video sources for mobile:', isMobile);
            
            if (isMobile) {
                const mobileWebmSrc = mainVideo.getAttribute('data-mobile-webm-src');
                const mobileMp4Src = mainVideo.getAttribute('data-mobile-src');
                
                // Check WebM support and file existence
                const webmSupported = supportsWebM();
                console.log('WebM supported:', webmSupported);
                
                if (webmSupported && mobileWebmSrc) {
                    const webmExists = await checkVideoExists(mobileWebmSrc);
                    console.log('Mobile WebM exists:', webmExists);
                    
                    if (webmExists) {
                        console.log('Using mobile WebM video:', mobileWebmSrc);
                        mainVideoSourceWebm.src = mobileWebmSrc;
                        mainVideoSourceMp4.src = mobileMp4Src; // Fallback
                        return;
                    }
                }
                
                // Fallback to mobile MP4
                console.log('Using mobile MP4 video:', mobileMp4Src);
                mainVideoSourceWebm.src = ''; // Clear WebM source
                mainVideoSourceMp4.src = mobileMp4Src;
                
            } else {
                // Desktop - use original MP4
                const desktopSrc = mainVideo.getAttribute('data-desktop-src');
                console.log('Using desktop video:', desktopSrc);
                mainVideoSourceWebm.src = ''; // Clear WebM source
                mainVideoSourceMp4.src = desktopSrc;
            }
        }
        // Initialize video based on device type
        async function initializeVideo() {
            console.log('Initializing video...');
            loadingMessage.style.display = 'block';

            const isMobile = isMobileDevice();
            console.log('Is mobile device:', isMobile);

            // Set appropriate video sources
            await setVideoSources(isMobile);

            if (isMobile) {
                // Configure for mobile
                console.log('Configuring for mobile device');
                
                // Remove autoplay completely for mobile
                mainVideo.removeAttribute('autoplay');
                
                // Set mobile-specific attributes
                mainVideo.setAttribute('playsinline', 'true');
                mainVideo.setAttribute('webkit-playsinline', 'true');
                mainVideo.muted = true;
                mainVideo.controls = false;
                
                // Reload video with new sources
                mainVideo.load();
                
                // Show play overlay for mobile
                setTimeout(() => {
                    loadingMessage.style.display = 'none';
                    videoPlayOverlay.style.display = 'flex';
                }, 1000);
                
            } else {
                // Desktop configuration
                console.log('Configuring for desktop device');
                mainVideo.setAttribute('autoplay', 'true');
                mainVideo.load();
                
                // Try autoplay for desktop
                mainVideo.addEventListener('canplay', function() {
                    console.log('Desktop video can play');
                    mainVideo.play().then(() => {
                        console.log('Desktop video started playing');
                        loadingMessage.style.display = 'none';
                        isVideoPlaying = true;
                    }).catch(error => {
                        console.log('Desktop autoplay failed:', error);
                        loadingMessage.style.display = 'none';
                        videoPlayOverlay.style.display = 'flex';
                    });
                });
            }

            videoInitialized = true;
        }

        // Handle video play button click with fallback logic
        function handleVideoPlay() {
            console.log('Play button clicked, attempt:', currentVideoAttempt + 1);
            
            const playPromise = mainVideo.play();
            
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    console.log('Video started playing successfully');
                    videoPlayOverlay.style.display = 'none';
                    loadingMessage.style.display = 'none';
                    isVideoPlaying = true;
                    currentVideoAttempt = 0; // Reset attempt counter
                }).catch(error => {
                    console.error('Video play failed:', error);
                    currentVideoAttempt++;
                    
                    // Try fallback strategies
                    if (currentVideoAttempt === 1) {
                        console.log('Trying fallback video format...');
                        tryFallbackVideo();
                    } else if (currentVideoAttempt === 2) {
                        console.log('Trying video reload...');
                        setTimeout(() => {
                            mainVideo.load();
                            setTimeout(() => {
                                mainVideo.play().then(() => {
                                    console.log('Video started on reload retry');
                                    videoPlayOverlay.style.display = 'none';
                                    loadingMessage.style.display = 'none';
                                    isVideoPlaying = true;
                                    currentVideoAttempt = 0;
                                }).catch(retryError => {
                                    console.error('Video play retry failed:', retryError);
                                    // Hide overlay anyway to show fallback background
                                    videoPlayOverlay.style.display = 'none';
                                    loadingMessage.style.display = 'none';
                                    currentVideoAttempt = 0;
                                });
                            }, 500);
                        }, 1000);
                    } else {
                        // Final fallback - hide overlay and show gradient background
                        console.log('All video attempts failed, showing fallback background');
                        videoPlayOverlay.style.display = 'none';
                        loadingMessage.style.display = 'none';
                        currentVideoAttempt = 0;
                    }
                });
            }
        }

        // Try fallback video format (switch between WebM and MP4)
        async function tryFallbackVideo() {
            console.log('Trying fallback video format');
            const isMobile = isMobileDevice();
            
            if (isMobile) {
                // If WebM was being used, try MP4 only
                if (mainVideoSourceWebm.src) {
                    console.log('Switching from WebM to MP4 only');
                    mainVideoSourceWebm.src = '';
                    mainVideoSourceMp4.src = mainVideo.getAttribute('data-mobile-src');
                } else {
                    // If MP4 was being used, try desktop version as last resort
                    console.log('Trying desktop video on mobile as fallback');
                    mainVideoSourceMp4.src = mainVideo.getAttribute('data-desktop-src');
                }
                
                mainVideo.load();
                
                // Auto-retry play after loading
                setTimeout(() => {
                    mainVideo.play().then(() => {
                        console.log('Fallback video started playing');
                        videoPlayOverlay.style.display = 'none';
                        loadingMessage.style.display = 'none';
                        isVideoPlaying = true;
                        currentVideoAttempt = 0;
                    }).catch(fallbackError => {
                        console.error('Fallback video also failed:', fallbackError);
                        // Will trigger the retry logic in handleVideoPlay
                    });
                }, 1000);
            }
        }

        // Event listeners
        if (videoPlayBtn) {
            videoPlayBtn.addEventListener('click', handleVideoPlay);
            videoPlayBtn.addEventListener('touchend', function(e) {
                e.preventDefault();
                handleVideoPlay();
            });
        }

        // Video error handling
        mainVideo.addEventListener('error', function(e) {
            console.error('Video error:', e);
            loadingMessage.textContent = 'Video unavailable - showing background';
            setTimeout(() => {
                loadingMessage.style.display = 'none';
                videoPlayOverlay.style.display = 'none';
            }, 2000);
        });

        // Video loaded event
        mainVideo.addEventListener('loadeddata', function() {
            console.log('Video data loaded');
            if (isMobileDevice() && !isVideoPlaying) {
                videoPlayOverlay.style.display = 'flex';
            }
        });

        // Hamburger menu functionality
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const menuOverlay = document.getElementById('menu-overlay');
        
        if (hamburgerBtn && menuOverlay) {
            hamburgerBtn.addEventListener('click', function() {
                menuOverlay.classList.toggle('active');
            });
            
            menuOverlay.addEventListener('click', function(e) {
                if (e.target === menuOverlay) {
                    menuOverlay.classList.remove('active');
                }
            });
        }
        
        // About Us functionality
        const aboutLink = document.getElementById('about-link');
        const aboutClose = document.getElementById('about-close');
        const homeSection = document.getElementById('home');
        const aboutSection = document.getElementById('about');
        const mainFooter = document.getElementById('main-footer');
        
        if (aboutLink) {
            aboutLink.addEventListener('click', function(e) {
                e.preventDefault();
                homeSection.style.display = 'none';
                aboutSection.style.display = 'block';
                mainFooter.style.display = 'none';
                menuOverlay.classList.remove('active');
                
                // Start about video
                aboutVideo.play().catch(error => {
                    console.log('About video autoplay failed:', error);
                });
            });
        }
        
        if (aboutClose) {
            aboutClose.addEventListener('click', function() {
                aboutSection.style.display = 'none';
                homeSection.style.display = '';
                mainFooter.style.display = '';
                aboutVideo.pause();
            });
        }
        
        // Close menu when menu items are clicked
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function() {
                menuOverlay.classList.remove('active');
            });
        });

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing video...');
            setTimeout(initializeVideo, 500);
        });

        // Fallback initialization
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeVideo);
        } else {
            setTimeout(initializeVideo, 500);
        }
    </script>
</body>
</html>